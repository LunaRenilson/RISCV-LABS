\documentclass[12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[portuguese]{babel}
\usepackage{amsmath}
\usepackage{geometry}
\geometry{a4paper, margin=2.5cm}

% Pacotes para código
\usepackage{listings}
\usepackage{xcolor}
\usepackage{tcolorbox} % mais bonito e personalizável

% Configuração de estilo para código
\lstdefinelanguage{riscv}{
  morekeywords={
    add,sub,mul,div,rem,
    and,or,xor,sll,srl,sra,
    lb,lh,lw,li,la,sb,sh,sw,
    beq,bne,blt,bge,jal,jalr,
    lui,auipc,nop,ecall,space,skip,data
  },
  sensitive=true,
  morecomment=[l]{\#},     % Comentários com #
  morestring=[b]"         % Strings entre aspas
}

\lstdefinestyle{meucodigo}{
  language=riscv,
  backgroundcolor=\color{gray!10},
  basicstyle=\ttfamily\small,
  frame=single,
  keywordstyle=\color{blue},
  commentstyle=\color{gray!60},
  stringstyle=\color{red!70!black},
  showstringspaces=false
}
\title{Relatório: Inferência de Rede Neural em RISC-V}
\author{Renilson C. de Luna Jr.}
\date{\today}

\begin{document}

\maketitle

\noindent
\section{Introdução}

  \hspace{2em}Este relatório descreve a implementação de um processo de inferência de rede neural utilizando arquitetura RISC-V de 32 bits. O objetivo é executar uma rede previamente treinada com pesos quantizados e otimizados, usando operações compatíveis com instruções básicas da ISA RISC-V.

  \hspace{2em}O sistema recebe os dados de entrada, executa as camadas da rede (como convoluções, ativações e normalizações) e gera a saída inferida com uso mínimo de instruções e memória. Este trabalho foca em eficiência, portabilidade e clareza do código, destacando os desafios encontrados e as soluções propostas.

\section{Módulo de Entrada e Parsing}
  \noindent
  \hspace{2em}A leitura dos dados de entrada é uma etapa crucial para o funcionamento da rede neural. O parser é responsável por interpretar os dados brutos e convertê-los em um formato que possa ser utilizado pela rede. A leitura dos pesos da rede foi feita aproveitando o fato de que a quantidade de vetores de uma camada i corresponde ao número de neurônios da camada, e cada vetor contém o número de pesos correspondente ao número de neurônios da camada anterior, segundo o exemplo: \\

\begin{tcolorbox}[
  colframe=blue!30!white,  % Borda verde com 50% de opacidade
  colback=white,             % Fundo branco
  boxrule=0.8pt,            % Espessura da borda
  arc=1mm,                  % Arredondamento dos cantos
  left=6pt,                 % Padding à esquerda
  right=6pt,                % Padding à direita
  top=6pt,                  % Padding superior
  bottom=6pt                % Padding inferio
]{
  
  $ 4, 10, 20, 3 \rightarrow $ 4 camadas:
  \begin{itemize}
      \item Entrada: 4 neurônios
      \item Oculta 1: 10 neurônios
      \item Oculta 2: 20 neurônios
      \item Saída: 3 neurônios
  \end{itemize}
  
  Logo, as camadas lN possuem matriz no formato:
  
  \begin{itemize}
      \item l1: $[10][4]$
      \item l2: $[20][10]$
      \item l3: $[3][20]$
  \end{itemize}
}\end{tcolorbox}  

Com os tamanhos dos vetores em mãos, e dado que cada inteiro é separado por vírgula, o parser lê os dados de entrada seguindo a seguinte regra:

\begin{enumerate}
  \item Lê o número de camadas da rede;
  \item Lê o número de neurônios da camada de entrada;
  \item Interpreta os tamanhos dos vetores de cada camada, armazenando-os em um vetor ln;
  \item Lê os pesos de cada camada, pulando a vírgula entre os números;
\end{enumerate}

\hspace{2em}Assim, é possível construir as matrizes de pesos de cada camada, armazenando-as em vetores de inteiros com tamanho o suficiente para conter todos os pesos em um vetor unidimensional:


\begin{lstlisting}[style=meucodigo]
.data
  # Vetores de pesos para cada camada
  l1: .space 4           # 4 valores de Entrada
  l2: .space 120          # 30 * 4 valores de Oculta 1
  l3: .space 900          # 30 * 30 valores de Oculta 2
  l4: .space 900          # 30 * 30 valores de Oculta 3
  l5: .space 900          # 30 * 30 valores de Oculta 4
  ln: .space 20           # Vetor de tamanhos das camadas
  saida: .space 3
\end{lstlisting}

\end{document}
